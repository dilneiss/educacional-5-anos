<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0"
    />
    <title>Jogo Educativo Infantil</title>
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
    />
    <style>
        /* Bloquear sele√ß√£o de texto e toque prolongado */
        body {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
        }

        /* Layout */
        body {
            font-family: "Arial", sans-serif;
            background-color: #fff3e0;
            margin-bottom: 80px;
        }

        .container {
            text-align: center;
        }
        .main-title {
            font-size: 3rem;
            font-weight: bold;
            color: #ff5722;
            margin: 40px 0 20px;
        }
        #start-menu {
            display: none;
            margin-top: 30px;
        }
        .start-menu-btn {
            width: 250px;
            display: inline-block;
            margin: 20px auto;
        }
        .start-menu-input {
            font-size: 24px;
            border-radius: 8px;
            border: 2px solid #ccc;
            padding: 8px 10px;
            width: 300px;
            max-width: 80%;
            text-align: center;
            margin-bottom: 20px;
        }
        button {
            font-size: 24px;
            padding: 15px 30px;
            margin: 15px;
            border-radius: 15px;
            background-color: #4caf50;
            border: none;
            color: white;
            cursor: pointer;
        }

        .feedback {
            font-size: 1.5rem;
            margin: 1rem 0;
            min-height: 60px;
        }

        .game-mode {
            background-color: #81d4fa;
            border-radius: 20px;
            padding: 20px;
            margin: 10px;
            cursor: pointer;
            font-size: 1.5rem;
            transition: transform 0.2s;
            border: 3px solid #000;
        }
        .game-mode:hover {
            transform: scale(1.05);
        }

        #game-area {
            display: none;
        }

        .player-info {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            border-radius: 15px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
            position: relative;
        }
        .player-name {
            font-size: 24px;
            color: #2e7d32;
            font-weight: bold;
            margin: 0;
        }
        .stars-info {
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .stars-info span {
            font-size: 28px;
        }

        /* Bot√£o e Modal de Figurinhas */
        #stickers-btn {
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            font-size: 20px;
            padding: 10px 20px;
            background: #ff9800;
        }
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 9998;
        }
        .stickers-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            padding: 30px;
            border-radius: 10px;
            z-index: 9999;
            width: 90%;
            max-width: 500px;
            display: none;
        }
        .stickers-modal h3 {
            margin-bottom: 20px;
        }
        .stickers-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        .sticker-item {
            font-size: 24px;
            background: #ffeb3b;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
            cursor: default;
        }

        /* Categorias */
        .category-game-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }
        .category-bin {
            width: 180px;
            min-height: 150px;
            border: 3px dashed #000;
            border-radius: 15px;
            background-color: #ffffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            gap: 10px;
            transition: background 0.3s;
        }
        .category-label {
            font-size: 1.2rem;
            font-weight: bold;
        }
        .bin-items-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            justify-content: center;
            min-height: 50px;
        }

        .category-item {
            width: 80px;
            height: 80px;
            margin: 5px;
            border-radius: 10px;
            font-size: 2rem;
            border: 3px solid #000;
            background-color: #c8e6c9;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .category-item.hidden-item {
            visibility: hidden;
        }
        .category-matched {
            background-color: #c8e6c9 !important;
            border-color: #4caf50 !important;
        }
        .category-wrong {
            background-color: #ffcdd2 !important;
            border-color: #c62828 !important;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0% {
                transform: translateX(0);
            }
            25% {
                transform: translateX(-5px);
            }
            50% {
                transform: translateX(5px);
            }
            100% {
                transform: translateX(0);
            }
        }

        /* Outros jogos */
        .numbers-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            justify-items: center;
            margin-top: 20px;
        }
        .number-option {
            background-color: #c8e6c9;
            width: 100px;
            height: 100px;
            margin: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            border-radius: 15px;
            cursor: pointer;
            border: 3px solid #000;
        }
        .target-number {
            background-color: #ffd700 !important;
            color: #000;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 120px;
            height: 120px;
            border-radius: 15px;
            font-size: 2rem;
            border: 3px solid #000;
        }

        .emoji-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        .emoji-option {
            background-color: #c8e6c9;
            width: 120px;
            height: 120px;
            margin: 10px;
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            border-radius: 15px;
            cursor: pointer;
            border: 3px solid #000;
        }
        .emoji-name {
            font-size: 14px;
            margin-top: 5px;
        }

        .counting-target {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 15px;
        }
        .count-box {
            width: 80px;
            height: 80px;
            font-size: 2rem;
            background: #fff9c4;
            border: 3px solid #000;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .counting-game .emoji-option {
            width: 100px;
            height: 100px;
            margin: 5px;
            font-size: 40px;
        }

        .word-letter {
            background-color: #ffd700;
            width: 60px;
            height: 60px;
            margin: 5px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            border-radius: 10px;
            cursor: pointer;
            border: 2px solid #000;
        }
        .word-target {
            font-size: 40px;
            margin: 20px;
            color: #888;
            opacity: 0.7;
        }
        .letter-box {
            display: inline-block;
            width: 40px;
            height: 40px;
            margin: 5px;
            font-size: 24px;
            color: #666;
            border-bottom: 3px solid #999;
        }
        .revealed {
            color: #2e7d32 !important;
            border-bottom: 3px solid #2e7d32;
        }
        .scrambled-letters {
            margin: 20px;
        }

        .shadow-container {
            display: flex;
            justify-content: space-around;
            margin: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .shadow-item {
            width: 150px;
            height: 150px;
            margin: 10px;
            transition: transform 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
            cursor: pointer;
            background: #fff9c4;
            border-radius: 15px;
            border: 3px solid #000;
        }
        .shadow-slot {
            width: 150px;
            height: 150px;
            margin: 10px;
            background: #e0e0e0;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
            opacity: 0.3;
            cursor: pointer;
            border: 3px solid #ccc;
            transition: all 0.2s ease;
        }
        .shadow-match {
            background: #c8e6c9 !important;
            border: 3px solid #4caf50 !important;
            opacity: 1 !important;
            font-size: 80px !important; /* garantir tamanho do emoji */
            width: 150px !important; /* manter tamanho */
        }
        .shadow-mismatch {
            background: #ffcdd2 !important;
            border: 3px solid #c62828 !important;
            animation: shake 0.5s;
        }

        .numbers-container,
        .quantities-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px auto;
            max-width: 800px;
        }
        .puzzle-piece {
            width: 130px;
            height: 130px;
            font-size: 30px;
            margin: 5px;
            background: #ffb74d;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }
        .puzzle-piece:hover {
            transform: scale(1.05);
        }
        .number-piece {
            font-size: 36px;
            font-weight: bold;
            background: #81d4fa;
        }
        .emoji-piece {
            background: transparent !important;
            padding: 5px;
        }
        .puzzle-emoji-grid {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            gap: 6px;
            width: 100%;
            height: 100%;
            overflow: hidden;
            padding: 5px;
        }
        .emoji-cell {
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
        }
        .puzzle-piece.selected {
            border-color: #4caf50;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }
        .puzzle-piece.matched {
            background: #c8e6c9;
            cursor: default;
            border-color: #4caf50;
        }
        .puzzle-piece.matched .emoji-cell {
            background: rgba(76, 175, 80, 0.1);
        }
        .puzzle-piece.wrong {
            animation: shake 0.5s;
            background: #ffcdd2;
        }
        .puzzle-piece.wrong .emoji-cell {
            background: rgba(244, 67, 54, 0.1);
        }

        .color-bin {
            width: 120px;
            height: 120px;
            margin: 10px;
            border: 3px dashed #000;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            background-color: white;
            cursor: pointer;
        }
        .color-bin span {
            font-size: 16px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
        }
        .color-item {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid #fff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        .color-item:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .weather-card {
            background: #fff;
            padding: 20px;
            margin: 20px;
            border-radius: 15px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            display: inline-block;
            width: 250px;
        }
        .weather-items {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        .weather-item {
            font-size: 30px;
            padding: 10px;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s;
            background: #f5f5f5;
        }
        .weather-item.selected {
            background: #c8e6c9 !important;
            transform: scale(1.1);
            border: 2px solid #4caf50;
        }

        .d-none {
            display: none !important;
        }

        /* ---- Jogo de Leitura ---- */
        .reading-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
        }
        .reading-word-box {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }
        .reading-syllable {
            background-color: #ffd54f;
            color: #000;
            font-size: 2rem;
            padding: 10px 20px;
            border-radius: 10px;
            border: 3px solid #000;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .reading-syllable:hover {
            transform: scale(1.05);
        }
        .reading-result {
            display: flex;
            gap: 5px;
            justify-content: center;
            margin-bottom: 20px;
        }
        .reading-result-syllable {
            width: 60px;
            height: 60px;
            background-color: #fff9c4;
            border: 3px solid #000;
            border-radius: 10px;
            font-size: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 5px;
        }
        .reading-result-syllable.correct {
            background-color: #c8e6c9;
            border-color: #4caf50;
        }
    </style>
</head>
<body class="d-flex flex-column min-vh-100" oncontextmenu="return false;" >

<div class="modal-backdrop" id="modal-backdrop"></div>
<div class="stickers-modal" id="stickers-modal">
    <h3>Minhas Figurinhas</h3>
    <div class="stickers-container" id="stickers-container"></div>
    <button class="btn btn-danger" onclick="closeStickersModal()">Fechar</button>
</div>

<div class="container flex-grow-1">
    <h1 class="main-title">Vamos Aprender!</h1>

    <div id="start-menu">
        <div id="continue-btn-container">
            <button class="btn btn-primary start-menu-btn" id="continueGameBtn">
                Continuar Jogo
            </button>
        </div>
        <button class="btn btn-success start-menu-btn" id="newGameBtn">
            Novo Jogo
        </button>

        <div class="d-none" id="newGameForm">
            <p>Digite seu nome para come√ßar:</p>
            <input
                    type="text"
                    id="playerNameInput"
                    class="start-menu-input"
            />
            <br />
            <button id="startNewGameBtn" class="btn btn-warning">
                Iniciar
            </button>
        </div>
    </div>

    <div class="player-info d-none" id="playerInfoContainer">
        <div class="player-name" id="player-name"></div>
        <div class="stars-info">
            <span>‚≠ê</span>
            <span id="stars-count">0</span>
        </div>
        <button id="stickers-btn" onclick="openStickersModal()">
            Figurinhas
        </button>
    </div>

    <!-- Menu principal (din√¢mico) -->
    <div id="main-menu" class="d-none">
        <div class="row g-2" id="games-list"></div>
    </div>

    <div id="game-area" class="d-none">
        <div id="content" class="my-4"></div>
        <div id="feedback" class="feedback text-center"></div>
        <div class="text-center my-3">
            <button class="btn btn-lg btn-primary" onclick="cancelNextGameAndMenu()">
                Voltar ao Menu
            </button>
        </div>
    </div>
</div>

<script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
></script>
<script>
    /* Bloquear destaque e arrasto de texto no toque */
    document.addEventListener('selectstart', (e) => e.preventDefault());
    /* Bloquear contextmenu do mouse */
    document.addEventListener('contextmenu', (e) => e.preventDefault());

    let savedName = localStorage.getItem("playerName") || "";
    let savedStars = parseInt(localStorage.getItem("stars") || "0", 10);

    let playerName = savedName;
    let stars = savedStars;
    let previousStars = stars;
    let currentGame = null;
    let speechSynth = window.speechSynthesis;

    /* Hist√≥ricos para evitar repeti√ß√£o de mesma jogada */
    let lastNumber = null;
    let lastLetter = null;
    let lastCount = null;
    let lastWordEmoji = null;
    let lastShadowSet = null;
    let lastPuzzleSet = null;
    let lastColorsSet = null;
    let lastWeather = null;
    let lastCategoriesSet = null;
    let lastReadingWord = null;

    /* Guardar estrelas por jogo */
    let gameStars = JSON.parse(localStorage.getItem("gameStars") || "{}");
    let nextGameTimeout = null; // Para cancelar setTimeout se o usu√°rio voltar ao menu

    /* Sistema de figurinhas */
    let stickerList = JSON.parse(localStorage.getItem("myStickers") || "[]");
    const possibleStickers = [
        "Pikachu",
        "Charmander",
        "Bulbasaur",
        "Squirtle",
        "Stitch",
        "Palworld1",
        "Palworld2",
        "Eevee",
        "Mew"
    ];

    const startMenuEl = document.getElementById("start-menu");
    const continueBtnContainer = document.getElementById("continue-btn-container");
    const continueGameBtn = document.getElementById("continueGameBtn");
    const newGameBtn = document.getElementById("newGameBtn");
    const newGameForm = document.getElementById("newGameForm");
    const playerNameInput = document.getElementById("playerNameInput");
    const startNewGameBtn = document.getElementById("startNewGameBtn");

    const playerInfoContainer = document.getElementById("playerInfoContainer");
    const playerNameEl = document.getElementById("player-name");
    const starsCountEl = document.getElementById("stars-count");

    const mainMenuEl = document.getElementById("main-menu");
    const gamesListEl = document.getElementById("games-list");
    const gameAreaEl = document.getElementById("game-area");

    const numbers = Array.from({ length: 20 }, (_, i) => i + 1);

    const emojiDatabase = {
        A: [
            { emoji: "‚úàÔ∏è", nome: "Avi√£o" },
            { emoji: "üå≥", nome: "√Årvore" },
            { emoji: "üé®", nome: "Arte" },
            { emoji: "üèπ", nome: "Arco e Flecha" },
            { emoji: "üêú", nome: "Aranha" },
            { emoji: "‚öì", nome: "√Çncora" },
            { emoji: "üé≠", nome: "Ator" },
            { emoji: "üöë", nome: "Ambul√¢ncia" },
            { emoji: "üåà", nome: "Arco-√≠ris" },
            { emoji: "üçö", nome: "Arroz" },
        ],
        B: [
            { emoji: "üéà", nome: "Bal√£o" },
            { emoji: "üö≤", nome: "Bicicleta" },
            { emoji: "üçå", nome: "Banana" },
            { emoji: "üîã", nome: "Bateria" },
            { emoji: "üèÄ", nome: "Basquete" },
            { emoji: "üêù", nome: "Abelha" },
            { emoji: "üçü", nome: "Batata Frita" },
            { emoji: "‚öñ", nome: "Balan√ßa" },
            { emoji: "üçÜ", nome: "Berinjela" },
            { emoji: "‚öΩ", nome: "Bola" },
        ],
        C: [
            { emoji: "üè°", nome: "Casa" },
            { emoji: "üè∞", nome: "Castelo" },
            { emoji: "üèôÔ∏è", nome: "Cidade" },
            { emoji: "üêç", nome: "Cobra" },
            { emoji: "üê∂", nome: "Cachorro" },
            { emoji: "‚òï", nome: "Caf√©" },
            { emoji: "üçµ", nome: "Ch√°" },
            { emoji: "üöó", nome: "Carro" },
            { emoji: "üé†", nome: "Carrossel" },
            { emoji: "ü¶å", nome: "Cervo" },
            { emoji: "ü•ï", nome: "Cenoura" },
            { emoji: "üîë", nome: "Chave" },
            { emoji: "ü¶â", nome: "Coruja" },
            { emoji: "üèÉ", nome: "Corrida" },
        ],
        D: [
            { emoji: "üé≤", nome: "Dado" },
            { emoji: "üêâ", nome: "Drag√£o" },
            { emoji: "üíé", nome: "Diamante" },
            { emoji: "üéØ", nome: "Dardo" },
            { emoji: "üìÖ", nome: "Data" },
        ],
        E: [
            { emoji: "‚≠ê", nome: "Estrela" },
            { emoji: "üìß", nome: "E-mail" },
            { emoji: "üêò", nome: "Elefante" },
            { emoji: "üîå", nome: "Energia" },
            { emoji: "üõ§", nome: "Estrada" },
        ],
        F: [
            { emoji: "üéó", nome: "Fita" },
            { emoji: "üå∏", nome: "Flor" },
            { emoji: "üêú", nome: "Formiga" },
            { emoji: "üî•", nome: "Fogo" },
            { emoji: "üé∫", nome: "Flauta" },
            { emoji: "üèÅ", nome: "Final" },
            { emoji: "üçÇ", nome: "Folha" },
            { emoji: "üöÄ", nome: "Foguete" },
            { emoji: "üåπ", nome: "Flor" },
        ],
        G: [
            { emoji: "üê¨", nome: "Golfinho" },
            { emoji: "üê±", nome: "Gato" },
            { emoji: "ü¶í", nome: "Girafa" },
            { emoji: "‚òÇÔ∏è", nome: "Guarda-chuva" },
            { emoji: "üé∏", nome: "Guitarra" },
            { emoji: "ü•Ö", nome: "Gol" },
            { emoji: "üèåÔ∏è", nome: "Golfe" },
        ],
        H: [
            { emoji: "üè•", nome: "Hospital" },
            { emoji: "üöÅ", nome: "Helic√≥ptero" },
            { emoji: "üêπ", nome: "Hamster" },
        ],
        I: [
            { emoji: "üèù", nome: "Ilha" },
            { emoji: "üí°", nome: "Ideia" },
            { emoji: "üì±", nome: "Internet" },
            { emoji: "üñº", nome: "Imagem" },
        ],
        J: [
            { emoji: "üé∑", nome: "Jazz" },
            { emoji: "üöô", nome: "Jipe" },
        ],
        K: [
            { emoji: "ü•ù", nome: "Kiwi" },
            { emoji: "ü§π", nome: "Karat√™" },
            { emoji: "ü•ã", nome: "Kimono" },
        ],
        L: [
            { emoji: "üçã", nome: "Lim√£o" },
            { emoji: "üìö", nome: "Livro" },
            { emoji: "üí°", nome: "L√¢mpada" },
            { emoji: "ü¶Å", nome: "Le√£o" },
            { emoji: "üåô", nome: "Lua" },
            { emoji: "üçä", nome: "Laranja" },
            { emoji: "üèûÔ∏è", nome: "Lago" },
            { emoji: "üõ≥", nome: "Lancha" },
        ],
        M: [
            { emoji: "üé∂", nome: "M√∫sica" },
            { emoji: "üé§", nome: "Microfone" },
            { emoji: "üçé", nome: "Ma√ß√£" },
            { emoji: "üêµ", nome: "Macaco" },
            { emoji: "üçà", nome: "Mel√£o" },
            { emoji: "üåä", nome: "Mar" },
            { emoji: "üèî", nome: "Montanha" },
            { emoji: "üó∫", nome: "Mapa" },
            { emoji: "‚úâÔ∏è", nome: "Mensagem" },
            { emoji: "üöá", nome: "Metr√¥" },
            { emoji: "ü¶á", nome: "Morcego" },
            { emoji: "üî®", nome: "Machado" },
        ],
        N: [
            { emoji: "‚ùÑÔ∏è", nome: "Neve" },
            { emoji: "üö¢", nome: "Navio" },
        ],
        O: [
            { emoji: "ü•ö", nome: "Ovo" },
            { emoji: "üè¢", nome: "Oficina" },
            { emoji: "üé®", nome: "Obra de Arte" },
            { emoji: "üöå", nome: "√înibus" },
        ],
        P: [
            { emoji: "üê†", nome: "Peixe" },
            { emoji: "üçï", nome: "Pizza" },
            { emoji: "üêß", nome: "Pinguim" },
            { emoji: "üéÅ", nome: "Presente" },
            { emoji: "üö™", nome: "Porta" },
            { emoji: "üêô", nome: "Polvo" },
            { emoji: "üì¶", nome: "Pacote" },
            { emoji: "ü•û", nome: "Panqueca" },
            { emoji: "ü•ñ", nome: "P√£o" },
        ],
        Q: [
            { emoji: "üëë", nome: "Queijo" },
            { emoji: "üÉè", nome: "Quebra-cabe√ßa" },
            { emoji: "üñº", nome: "Quadro" },
        ],
        R: [
            { emoji: "ü¶ä", nome: "Raposa" },
            { emoji: "üìª", nome: "R√°dio" },
            { emoji: "ü¶è", nome: "Rinoceronte" },
            { emoji: "ü§ñ", nome: "Robo" },
        ],
        S: [
            { emoji: "üö¶", nome: "Sem√°foro" },
            { emoji: "üåû", nome: "Sol" },
            { emoji: "ü•ó", nome: "Salada" },
            { emoji: "üîî", nome: "Sino de Natal" },
        ],
        T: [
            { emoji: "üé©", nome: "Teatro" },
            { emoji: "üåÆ", nome: "Taco" },
            { emoji: "üöÜ", nome: "Trem" },
            { emoji: "üéπ", nome: "Teclado" },
            { emoji: "üé∫", nome: "Trompete" },
            { emoji: "üìû", nome: "Telefone" },
            { emoji: "üåç", nome: "Terra" },
            { emoji: "üèÜ", nome: "Trof√©u" },
            { emoji: "ü•Å", nome: "Tambor" },
        ],
        U: [
            { emoji: "ü¶Ñ", nome: "Unic√≥rnio" },
            { emoji: "üçá", nome: "Uva" },
        ],
        V: [
            { emoji: "üéª", nome: "Violino" },
            { emoji: "üåã", nome: "Vulc√£o" },
            { emoji: "üç∑", nome: "Vinho" },
            { emoji: "üéÆ", nome: "Videogame" },
            { emoji: "üìπ", nome: "V√≠deo" },
            { emoji: "üöê", nome: "Van" },
            { emoji: "üîä", nome: "Volume" },
        ],
        X: [{ emoji: "‚ùå", nome: "Xis" }],
        Z: [{ emoji: "ü¶ì", nome: "Zebra" }],
    };

    const readingWords = [
        { word: "barata", syllables: ["ba", "ra", "ta"] },
        { word: "banana", syllables: ["ba", "na", "na"] },
        { word: "pipoca", syllables: ["pi", "po", "ca"] },
        { word: "macaco", syllables: ["ma", "ca", "co"] },
        { word: "cavalo", syllables: ["ca", "va", "lo"] },
        { word: "tartaruga", syllables: ["tar", "ta", "ru", "ga"] },
        { word: "amigo", syllables: ["a", "mi", "go"] },
        { word: "arara", syllables: ["a", "ra", "ra"] },
        { word: "batata", syllables: ["ba", "ta", "ta"] },
        { word: "girafa", syllables: ["gi", "ra", "fa"] },
        { word: "cachorro", syllables: ["ca", "cho", "rro"] },
    ];

    window.onload = function () {
        showStartMenu();
    };

    function showStartMenu() {
        startMenuEl.style.display = "block";
        if (!savedName) {
            continueBtnContainer.style.display = "none";
        } else {
            continueBtnContainer.style.display = "block";
        }
        mainMenuEl.classList.add("d-none");
        playerInfoContainer.classList.add("d-none");
        gameAreaEl.classList.add("d-none");
        playerNameInput.value = savedName;
    }

    continueGameBtn.onclick = function () {
        playerName = savedName;
        stars = savedStars;
        previousStars = stars;
        localStorage.setItem("stars", String(stars));
        localStorage.setItem("playerName", playerName);
        startMenuEl.style.display = "none";
        showPlayerInfo();
        buildMainMenu();
        showMainMenu();
    };

    newGameBtn.onclick = function () {
        newGameForm.classList.remove("d-none");
    };

    startNewGameBtn.onclick = function () {
        const chosenName = playerNameInput.value.trim();
        if (!chosenName) {
            alert("Por favor, informe um nome para iniciar!");
            return;
        }
        playerName = chosenName;
        stars = 0;
        previousStars = 0;
        savedName = playerName;
        savedStars = stars;
        localStorage.setItem("playerName", playerName);
        localStorage.setItem("stars", String(stars));

        startMenuEl.style.display = "none";
        showPlayerInfo();
        buildMainMenu();
        showMainMenu();
    };

    function showPlayerInfo() {
        playerInfoContainer.classList.remove("d-none");
        playerNameEl.textContent = playerName;
        starsCountEl.textContent = stars;
    }

    function buildMainMenu() {
        mainMenuEl.classList.remove("d-none");
        gamesListEl.innerHTML = "";

        // Lista de jogos + √≠cone + quantas estrelas
        const gameConfigs = [
            { id: "numbers", label: "üî¢ N√∫meros" },
            { id: "letters", label: "üî§ Letras" },
            { id: "counting", label: "üçé Contar" },
            { id: "word", label: "üß© Palavras" },
            { id: "shadows", label: "üé≠ Sombras" },
            { id: "puzzle", label: "üß© Quebra cabe√ßa" },
            { id: "colors", label: "üé® Cores" },
            { id: "weather", label: "‚òî Clima" },
            { id: "categories", label: "üöÄ Categorias" },
            { id: "reading", label: "üìñ Aprender a Ler" },
        ];

        gameConfigs.forEach((cfg) => {
            const colDiv = document.createElement("div");
            colDiv.className = "col-12 col-sm-6 col-lg-4";

            const starsInThisGame = gameStars[cfg.id] || 0;
            const gmDiv = document.createElement("div");
            gmDiv.className = "game-mode";
            gmDiv.onclick = () => startGame(cfg.id);
            gmDiv.innerText = `${cfg.label} (${starsInThisGame}‚≠ê)`;
            colDiv.appendChild(gmDiv);
            gamesListEl.appendChild(colDiv);
        });
    }

    function showMainMenu() {
        clearTimeoutIfAny();
        gameAreaEl.classList.add("d-none");
        mainMenuEl.classList.remove("d-none");

        if (stars > previousStars) {
            speak(`${playerName}, voc√™ tem ${stars} estrelas! Muito bem!`);
            previousStars = stars;
        } else if (stars < previousStars && stars > 0) {
            speak(`${playerName}, agora voc√™ tem ${stars} estrelas. Vamos recuperar!`);
            previousStars = stars;
        }
    }

    function startGame(mode) {
        clearTimeoutIfAny();
        currentGame = mode;
        mainMenuEl.classList.add("d-none");
        gameAreaEl.classList.remove("d-none");
        gameAreaEl.style.display = "block";
        document.getElementById("feedback").textContent = "";

        switch (mode) {
            case "numbers":
                initNumbersGame();
                break;
            case "letters":
                initLettersGame();
                break;
            case "counting":
                initCountingGame();
                break;
            case "word":
                initWordGame();
                break;
            case "shadows":
                initShadowGame();
                break;
            case "puzzle":
                initPuzzleGame();
                break;
            case "colors":
                initColorGame();
                break;
            case "weather":
                initWeatherGame();
                break;
            case "categories":
                initCategoryGame();
                break;
            case "reading":
                initReadingGame();
                break;
        }
    }

    function scheduleNewGame(mode, delay) {
        clearTimeoutIfAny();
        nextGameTimeout = setTimeout(() => {
            startGame(mode);
        }, delay);
    }

    function cancelNextGameAndMenu() {
        clearTimeoutIfAny();
        showMainMenu();
    }

    function clearTimeoutIfAny() {
        if (nextGameTimeout) {
            clearTimeout(nextGameTimeout);
            nextGameTimeout = null;
        }
    }

    /*********** N√öMEROS ************/
    function initNumbersGame() {
        const content = document.getElementById("content");

        let targetNumber = numbers[Math.floor(Math.random() * numbers.length)];
        while (targetNumber === lastNumber) {
            targetNumber = numbers[Math.floor(Math.random() * numbers.length)];
        }
        lastNumber = targetNumber;

        content.innerHTML = `
      <h2>Encontre o n√∫mero:</h2>
      <div style="display:flex; justify-content:center; margin-top:20px;">
        <div class="target-number">${targetNumber}</div>
      </div>
      <div class="numbers-grid" id="numbers-grid"></div>
    `;

        const options = shuffle([
            targetNumber,
            ...shuffle(numbers.filter((n) => n !== targetNumber)).slice(0, 4),
        ]);
        const grid = document.getElementById("numbers-grid");
        options.forEach((num) => {
            const div = document.createElement("div");
            div.className = "number-option";
            div.textContent = num;
            div.onclick = () => checkNumber(num === targetNumber);
            grid.appendChild(div);
        });

        speak(`Encontre o n√∫mero ${targetNumber}`);
    }

    function checkNumber(isCorrect) {
        if (isCorrect) {
            updateStars(1);
            showFeedback("üéØ Correto! Voc√™ √© demais!", true);
            scheduleNewGame("numbers", 2000);
        } else {
            updateStars(-1);
            showFeedback("ü§î Tente novamente!", false);
            speak("Ops! Esse n√£o √© o n√∫mero");
        }
    }

    /*********** LETRAS ************/
    function initLettersGame() {
        const content = document.getElementById("content");
        const validLetters = Object.keys(emojiDatabase);

        let targetLetter =
            validLetters[Math.floor(Math.random() * validLetters.length)];
        while (targetLetter === lastLetter) {
            targetLetter =
                validLetters[Math.floor(Math.random() * validLetters.length)];
        }
        lastLetter = targetLetter;

        const validEmojis = emojiDatabase[targetLetter];

        content.innerHTML = `
      <h2>Encontre emojis que come√ßam com:</h2>
      <div class="target-display" style="font-size:4rem;">${targetLetter}</div>
      <div class="emoji-grid"></div>
    `;

        const grid = document.querySelector(".emoji-grid");
        const allEmojis = Object.values(emojiDatabase).flat();

        const correctOptions = shuffle([...validEmojis]).slice(0, 3);
        const incorrectOptions = shuffle(
            allEmojis.filter((e) => !validEmojis.includes(e))
        ).slice(0, 7);
        const mixedOptions = shuffle([...correctOptions, ...incorrectOptions]);

        mixedOptions.forEach((emojiObj) => {
            const div = document.createElement("div");
            div.className = "emoji-option";
            div.innerHTML = `
        <div>${emojiObj.emoji}</div>
        <div class="emoji-name">${emojiObj.nome}</div>
      `;
            div.onclick = () => checkEmoji(validEmojis.includes(emojiObj), emojiObj.nome);
            grid.appendChild(div);
        });

        speak(`Encontre coisas que come√ßam com a letra ${targetLetter}`);
    }

    function checkEmoji(isCorrect, nome) {
        if (isCorrect) {
            updateStars(1);
            showFeedback("üåà Certo! Combina√ß√£o perfeita!", true);
            scheduleNewGame("letters", 2000);
        } else {
            updateStars(-1);
            showFeedback(`üí° "${nome}" come√ßa com ${nome[0].toUpperCase()}!`, false);
            speak(`Ops! ${nome} come√ßa com ${nome[0].toUpperCase()}!`);
        }
    }

    /*********** CONTAR ************/
    function initCountingGame() {
        const content = document.getElementById("content");
        let targetCount = Math.floor(Math.random() * 20) + 1;
        while (targetCount === lastCount) {
            targetCount = Math.floor(Math.random() * 20) + 1;
        }
        lastCount = targetCount;

        const possibleEmojis = ["üçé", "‚≠ê", "üêª", "üéà", "üç™"];
        const targetEmoji = shuffle(possibleEmojis)[0];

        content.innerHTML = `
      <h2>Conte at√©:</h2>
      <div class="counting-target">
        <div class="count-box">${targetCount}</div>
        <div class="count-box">${targetEmoji}</div>
      </div>
      <div id="counter">0</div>
      <div class="emoji-grid"></div>
    `;

        const grid = document.querySelector(".emoji-grid");
        const distractors = [
            "üê∂",
            "üçâ",
            "üöó",
            "üéÆ",
            "üçï",
            "üèÄ",
            "üê†",
            "üç©",
            "üöÇ",
            "üåª",
        ];
        const options = shuffle([
            targetEmoji,
            ...shuffle(distractors).slice(0, 9),
        ]);

        options.forEach((emoji) => {
            const div = document.createElement("div");
            div.className = "emoji-option";
            div.textContent = emoji;
            div.onclick = () => handleCountClick(emoji === targetEmoji, targetCount);
            grid.appendChild(div);
        });

        speak(`Clique ${targetCount} vezes no ${getEmojiName(targetEmoji)}`);
    }

    function handleCountClick(isCorrect, target) {
        if (!isCorrect) {
            speak("Esse n√£o √© o emoji correto!");
            updateStars(-1);
            showFeedback("‚ùå Emoji errado!", false);
            return;
        }
        const counter = document.getElementById("counter");
        let count = parseInt(counter.textContent) + 1;
        counter.textContent = count;
        speak(count.toString());

        if (count === target) {
            updateStars(1);
            showFeedback("üéâ Parab√©ns! Contagem correta!", true);
            scheduleNewGame("counting", 2000);
        }
    }

    function getEmojiName(emoji) {
        const names = {
            "üçé": "ma√ß√£",
            "‚≠ê": "estrela",
            "üêª": "urso",
            "üéà": "bal√£o",
            "üç™": "biscoito",
            "üê∂": "cachorro",
            "üçâ": "melancia",
            "üöó": "carro",
            "üéÆ": "videogame",
            "üçï": "pizza",
            "üèÄ": "bola",
            "üê†": "peixe",
            "üç©": "rosquinha",
            "üöÇ": "trem",
            "üåª": "girassol",
        };
        return names[emoji] || "objeto";
    }

    /*********** PALAVRAS ************/
    function initWordGame() {
        const content = document.getElementById("content");
        content.innerHTML = "<h2>Monte a palavra do emoji:</h2>";

        const allEmojis = Object.values(emojiDatabase).flat();
        let randomEmoji = shuffle(allEmojis)[0];
        while (randomEmoji === lastWordEmoji) {
            randomEmoji = shuffle(allEmojis)[0];
        }
        lastWordEmoji = randomEmoji;

        const originalName = randomEmoji.nome.toUpperCase();
        const targetLetters = Array.from(originalName).filter(
            (c) => c !== " " && c !== "-"
        );

        let targetDisplay = "";
        targetLetters.forEach((letter, index) => {
            targetDisplay += `<span class="letter-box" id="target-letter-${index}">${letter}</span>`;
        });

        content.innerHTML += `
      <div class="word-target">
        ${randomEmoji.emoji} <div id="target-word">${targetDisplay}</div>
      </div>
      <div class="scrambled-letters" id="scrambled-letters"></div>
    `;

        let scrambledLetters = shuffle([...targetLetters]);
        const lettersContainer = document.getElementById("scrambled-letters");
        scrambledLetters.forEach((letter) => {
            const div = document.createElement("div");
            div.className = "word-letter";
            div.textContent = letter;
            div.onclick = function () {
                handleLetterClick(this, targetLetters);
            };
            lettersContainer.appendChild(div);
        });

        speak(`Monte a palavra: ${randomEmoji.nome}`);
    }

    function handleLetterClick(letterElement, targetLetters) {
        const revealedLetters = document.querySelectorAll(
            "#target-word .revealed"
        );
        const nextIndex = revealedLetters.length;

        speak(letterElement.textContent);

        if (nextIndex < targetLetters.length) {
            const correctLetter = targetLetters[nextIndex];

            if (letterElement.textContent === correctLetter) {
                document
                    .getElementById(`target-letter-${nextIndex}`)
                    .classList.add("revealed");
                letterElement.style.visibility = "hidden";

                if (nextIndex === targetLetters.length - 1) {
                    showFeedback("üéâ Parab√©ns! Palavra correta!", true);
                    updateStars(1);
                    scheduleNewGame("word", 2000);
                }
            } else {
                showFeedback("üòä Tente novamente!", false);
                speak("Essa n√£o √© a letra correta");
                updateStars(-1);
            }
        }
    }

    /*********** SOMBRAS ************/
    function initShadowGame() {
        const content = document.getElementById("content");
        content.innerHTML = "<h2>Toque em um emoji e depois em sua sombra:</h2>";

        const allShadowEmojis = Object.values(emojiDatabase)
            .flat()
            .map((itemObj) => itemObj.emoji);

        let uniqueEmojis = Array.from(new Set(allShadowEmojis));
        // Garante que n√£o seja o mesmo set da √∫ltima vez
        let chosenEmojis = shuffle(uniqueEmojis).slice(0, 4);
        if (JSON.stringify(chosenEmojis) === JSON.stringify(lastShadowSet)) {
            chosenEmojis = shuffle(uniqueEmojis).slice(0, 4);
        }
        lastShadowSet = chosenEmojis;

        content.innerHTML += `
      <div class="shadow-container" id="shadow-slots">
        ${chosenEmojis
            .map(
                (emoji) => `
              <div class="shadow-slot" data-expected="${emoji}"
                   onclick="selectShadowSlot(this, '${emoji}')">
                ${emoji}
              </div>
            `
            )
            .join("")}
      </div>
    `;

        content.innerHTML += `
      <div class="shadow-container" id="shadow-items">
        ${shuffle(chosenEmojis)
            .map(
                (emoji) => `
              <div class="shadow-item"
                   onclick="selectShadowItem(this, '${emoji}')">
                ${emoji}
              </div>
            `
            )
            .join("")}
      </div>
    `;

        window.shadowGameState = {
            correctMatches: 0,
            totalItems: chosenEmojis.length,
            selectedEmoji: null,
            selectedElement: null,
        };

        speak("Toque em um emoji e depois na sua sombra correspondente");
    }

    function selectShadowItem(element, emoji) {
        if (window.shadowGameState.selectedElement) {
            window.shadowGameState.selectedElement.style.opacity = "1";
        }
        window.shadowGameState.selectedEmoji = emoji;
        window.shadowGameState.selectedElement = element;
        element.style.opacity = "0.5";
    }

    function selectShadowSlot(slotElement, expectedEmoji) {
        const selected = window.shadowGameState.selectedEmoji;
        const selectedEl = window.shadowGameState.selectedElement;
        if (!selected) return;

        if (selected === expectedEmoji) {
            slotElement.textContent = selected; // manter o emoji e fonte
            slotElement.classList.add("shadow-match");
            slotElement.classList.remove("shadow-slot");
            window.shadowGameState.correctMatches++;
            if (selectedEl) selectedEl.style.display = "none";
            if (
                window.shadowGameState.correctMatches ===
                window.shadowGameState.totalItems
            ) {
                updateStars(1);
                showFeedback("üéâ Parab√©ns! Todas sombras combinadas!", true);
                scheduleNewGame("shadows", 2000);
            } else {
                showFeedback("‚úÖ Correto!", true);
                speak("Muito bem!");
            }
        } else {
            slotElement.classList.add("shadow-mismatch");
            setTimeout(() => slotElement.classList.remove("shadow-mismatch"), 1000);
            speak("Essa n√£o √© a sombra correta, voc√™ perdeu uma estrela");
            updateStars(-1);
            showFeedback("Ops! Sombra incorreta!", false);
        }

        if (selectedEl) {
            selectedEl.style.opacity = "1";
        }
        window.shadowGameState.selectedEmoji = null;
        window.shadowGameState.selectedElement = null;
    }

    /*********** PUZZLE N√öMEROS ************/
    function initPuzzleGame() {
        window.puzzleGameState = {
            selectedNumber: null,
            correctMatches: 0,
            totalPairs: 5,
        };

        const content = document.getElementById("content");
        content.innerHTML = "<h2>Combine os n√∫meros com a quantidade correta:</h2>";

        let randomNums = shuffle([...Array(10)].map((_, i) => i + 1)).slice(0, 5);
        while (JSON.stringify(randomNums) === JSON.stringify(lastPuzzleSet)) {
            randomNums = shuffle([...Array(10)].map((_, i) => i + 1)).slice(0, 5);
        }
        lastPuzzleSet = randomNums;

        const emojis = [
            "üçé",
            "‚≠ê",
            "üéà",
            "üê±",
            "üöó",
            "üéÆ",
            "üçï",
            "üê∂",
            "üå∫",
            "üé®",
        ];

        content.innerHTML += `
      <div class="numbers-container">
        ${randomNums
            .map(
                (num) => `
            <div class="puzzle-piece number-piece"
                 onclick="selectNumber(this, ${num})"
                 data-number="${num}">
              ${num}
            </div>
          `
            )
            .join("")}
      </div>
    `;

        content.innerHTML += `
      <div class="quantities-container">
        ${shuffle(randomNums)
            .map(
                (num) => `
            <div class="puzzle-piece emoji-piece"
                 onclick="matchQuantity(this, ${num})"
                 data-number="${num}">
              <div class="puzzle-emoji-grid">
                ${Array(num)
                    .fill(emojis[num - 1])
                    .map(
                        (emoji) => `
                  <div class="emoji-cell">${emoji}</div>
                `
                    )
                    .join("")}
              </div>
            </div>
          `
            )
            .join("")}
      </div>
    `;

        speak(`Conte o n√∫mero de figuras e combine com o n√∫mero correto`);
    }

    function selectNumber(element, number) {
        document.querySelectorAll(".number-piece").forEach((piece) => {
            piece.classList.remove("selected");
        });
        element.classList.add("selected");
        window.puzzleGameState.selectedNumber = number;
    }

    function matchQuantity(element, quantity) {
        if (window.puzzleGameState.selectedNumber === null) {
            showFeedback("Selecione um n√∫mero primeiro!", false);
            return;
        }

        if (quantity === window.puzzleGameState.selectedNumber) {
            element.classList.add("matched");
            document
                .querySelector(`.number-piece[data-number="${quantity}"]`)
                .classList.add("matched");
            window.puzzleGameState.correctMatches++;
            showFeedback("üéØ Combina√ß√£o correta!", true);

            if (
                window.puzzleGameState.correctMatches ===
                window.puzzleGameState.totalPairs
            ) {
                updateStars(1);
                showFeedback("üéâ Parab√©ns! Voc√™ completou o quebra-cabe√ßa!", true);
                scheduleNewGame("puzzle", 2000);
            }
        } else {
            showFeedback("‚ùå Tente novamente!", false);
            element.classList.add("wrong");
            setTimeout(() => {
                element.classList.remove("wrong");
            }, 500);
            updateStars(-1);
        }

        window.puzzleGameState.selectedNumber = null;
        document.querySelectorAll(".number-piece").forEach((piece) => {
            if (!piece.classList.contains("matched")) {
                piece.classList.remove("selected");
            }
        });
    }

    /*********** CORES ************/
    function initColorGame() {
        const allColors = [
            { name: "Vermelho", hex: "#FF0000" },
            { name: "Azul", hex: "#0000FF" },
            { name: "Verde", hex: "#00FF00" },
            { name: "Amarelo", hex: "#FFD700" },
            { name: "Roxo", hex: "#800080" },
            { name: "Laranja", hex: "#FFA500" },
            { name: "Rosa", hex: "#FF69B4" },
            { name: "Marrom", hex: "#8B4513" },
        ];

        const content = document.getElementById("content");
        content.innerHTML = "<h2>Toque em uma cor e depois na caixa correta:</h2>";

        let roundColors = shuffle(allColors).slice(0, 3);
        while (JSON.stringify(roundColors) === JSON.stringify(lastColorsSet)) {
            roundColors = shuffle(allColors).slice(0, 3);
        }
        lastColorsSet = roundColors;

        content.innerHTML += `
      <div style="margin: 20px; display: flex; justify-content: center; gap: 15px;" id="color-items">
        ${roundColors
            .map(
                (color) => `
            <div class="color-item"
                 style="background:${color.hex}"
                 onclick="selectColorItem(this, '${color.hex}')"
                 data-colorname="${color.name}">
            </div>
          `
            )
            .join("")}
      </div>
    `;

        content.innerHTML += `
      <div style="margin-top:30px; display: flex; justify-content: center; gap: 20px;" id="color-bins">
        ${roundColors
            .map(
                (color) => `
            <div class="color-bin"
                 style="border-color:${color.hex}"
                 data-targetcolor="${color.hex}"
                 data-filled="false"
                 onclick="placeColor(this, '${color.hex}')">
              <span style="color: ${color.hex}">${color.name}</span>
            </div>
          `
            )
            .join("")}
      </div>
    `;

        window.colorGameState = {
            totalColors: roundColors.length,
            correctMatches: 0,
            selectedColor: null,
            selectedElement: null,
        };

        speak(`Combine as cores nas caixas correspondentes`);
    }

    function selectColorItem(el, color) {
        if (window.colorGameState.selectedElement) {
            window.colorGameState.selectedElement.style.opacity = "1";
        }
        window.colorGameState.selectedColor = color;
        window.colorGameState.selectedElement = el;
        el.style.opacity = "0.5";
    }

    function placeColor(binEl, targetColor) {
        const selected = window.colorGameState.selectedColor;
        const selectedEl = window.colorGameState.selectedElement;
        if (!selected) return;
        if (binEl.getAttribute("data-filled") === "true") {
            showFeedback("Esta caixa j√° est√° preenchida!", false);
            if (selectedEl) selectedEl.style.opacity = "1";
            window.colorGameState.selectedColor = null;
            window.colorGameState.selectedElement = null;
            return;
        }

        if (selected === targetColor) {
            binEl.style.backgroundColor = selected;
            binEl.setAttribute("data-filled", "true");
            window.colorGameState.correctMatches++;
            showFeedback("üåü Cor correta!", true);
            if (selectedEl) selectedEl.style.display = "none";

            if (
                window.colorGameState.correctMatches ===
                window.colorGameState.totalColors
            ) {
                updateStars(1);
                showFeedback("üéâ Parab√©ns! Voc√™ completou todas as cores!", true);
                scheduleNewGame("colors", 2000);
            }
        } else {
            showFeedback("üòä Tente outra cor", false);
            binEl.style.animation = "shake 0.5s";
            setTimeout(() => {
                binEl.style.animation = "";
            }, 500);
            updateStars(-1);
            speak("Cor incorreta, tente novamente");
        }

        if (selectedEl) {
            selectedEl.style.opacity = "1";
        }
        window.colorGameState.selectedColor = null;
        window.colorGameState.selectedElement = null;
    }

    /*********** CLIMA ************/
    function initWeatherGame() {
        const weatherData = [
            { icon: "‚òÄÔ∏è", correctItems: ["üï∂Ô∏è", "üé©", "üß¥"], title: "Ensolarado" },
            { icon: "üåßÔ∏è", correctItems: ["‚òÇÔ∏è", "üß•", "ü•æ"], title: "Chuvoso" },
            { icon: "‚ùÑÔ∏è", correctItems: ["üß§", "üß£", "üéø"], title: "Frio" },
        ];

        const content = document.getElementById("content");
        let currentWeather = weatherData[Math.floor(Math.random() * weatherData.length)];
        while (currentWeather === lastWeather) {
            currentWeather = weatherData[Math.floor(Math.random() * weatherData.length)];
        }
        lastWeather = currentWeather;

        const incorrectItems = ["üé∏", "üìò", "üéà", "üé™", "üé≠", "üé®"];
        const allItems = shuffle([
            ...currentWeather.correctItems,
            ...shuffle(incorrectItems).slice(0, 3),
        ]);

        content.innerHTML = `
      <h2>Escolha os itens para o clima:</h2>
      <div class="weather-card">
        <div style="font-size:60px">${currentWeather.icon}</div>
        <h3>${currentWeather.title}</h3>
        <div class="weather-items" id="weather-items">
          ${allItems
            .map(
                (item) => `
              <div class="weather-item"
                   data-item="${item}"
                   onclick="handleWeatherItem(this, '${item}', '${currentWeather.icon}')">
                ${item}
              </div>
            `
            )
            .join("")}
        </div>
      </div>
    `;

        window.weatherGameState = {
            correctCount: 0,
            totalCorrect: currentWeather.correctItems.length,
            currentIcon: currentWeather.icon,
        };

        speak(`Selecione as figuras que voc√™ usaria para o clima ${currentWeather.title}`);
    }

    function handleWeatherItem(element, item, correctIcon) {
        if (element.classList.contains("selected")) return;

        const correctItems = {
            "‚òÄÔ∏è": ["üï∂Ô∏è", "üé©", "üß¥"],
            "üåßÔ∏è": ["‚òÇÔ∏è", "üß•", "ü•æ"],
            "‚ùÑÔ∏è": ["üß§", "üß£", "üéø"],
        }[correctIcon];

        if (correctItems.includes(item)) {
            element.classList.add("selected");
            showFeedback("‚úîÔ∏è Item correto!", true);
            window.weatherGameState.correctCount++;

            if (
                window.weatherGameState.correctCount ===
                window.weatherGameState.totalCorrect
            ) {
                updateStars(1);
                showFeedback("üéâ Parab√©ns! Voc√™ completou o desafio!", true);
                scheduleNewGame("weather", 2000);
            }
        } else {
            element.style.background = "#FFCDD2";
            element.style.animation = "shake 0.5s";
            showFeedback("‚ùå N√£o √© para este clima", false);
            speak("N√£o √© para este clima");
            setTimeout(() => {
                element.style.background = "";
                element.style.animation = "";
            }, 1000);
            updateStars(-1);
        }
    }

    /*********** CATEGORIAS ************/
    function initCategoryGame() {
        const content = document.getElementById("content");
        content.innerHTML = "<h2>Classifique os itens em suas categorias:</h2>";

        const categories = [
            {
                name: "Animais",
                icon: "üê∂",
                items: [
                    "üê±",
                    "üêô",
                    "üê∂",
                    "üê∑",
                    "ü¶ä",
                    "ü¶Å",
                    "üêØ",
                    "üê∫",
                    "üê∏",
                    "ü¶ì",
                    "ü¶í",
                    "üêµ",
                    "üêº",
                    "üêπ",
                    "üê∞",
                    "üêª",
                    "üê®",
                    "üêî",
                    "ü¶Ü",
                    "ü¶Ö",
                    "ü¶â",
                    "üê¢",
                    "üêç",
                    "ü¶ã",
                    "ü¶á",
                    "ü¶î",
                    "ü¶£",
                    "üêä",
                    "üêõ",
                    "ü¶ï",
                    "ü¶ñ",
                ],
            },
            {
                name: "Frutas",
                icon: "üçé",
                items: [
                    "üçé",
                    "üçå",
                    "üçá",
                    "üçä",
                    "ü•ù",
                    "üçê",
                    "üçç",
                    "üçë",
                    "üçí",
                    "üçâ",
                    "üçì",
                    "ü•≠",
                    "üçÖ",
                    "üçè",
                    "üçã",
                    "ü••",
                    "ü´ê",
                ],
            },
            {
                name: "Ve√≠culos",
                icon: "üöó",
                items: [
                    "üöó",
                    "‚úàÔ∏è",
                    "üö≤",
                    "üöå",
                    "‚õµ",
                    "üöï",
                    "üöô",
                    "üöé",
                    "üèéÔ∏è",
                    "üöì",
                    "üöë",
                    "üöí",
                    "üöê",
                    "üõµ",
                    "üèçÔ∏è",
                    "üöÇ",
                    "üöÜ",
                    "üöá",
                    "üöù",
                    "üöû",
                    "üöä",
                    "üõ©Ô∏è",
                    "üö§",
                    "‚õ¥Ô∏è",
                    "üö¢",
                    "üõ•Ô∏è",
                    "üõ≥Ô∏è",
                    "üöÄ",
                    "üöÅ",
                    "üö°",
                    "üö†",
                    "üöü",
                    "ü¶º",
                ],
            },
        ];

        const allCategoryItems = [];
        categories.forEach((cat) => {
            const shuffledItems = [...cat.items];
            shuffle(shuffledItems);
            const fiveItems = shuffledItems.slice(0, 5);
            fiveItems.forEach((item) => {
                allCategoryItems.push({ emoji: item, category: cat.name });
            });
        });

        // Garante n√£o repetir o mesmo set de categorias
        const currentSet = JSON.stringify(allCategoryItems);
        if (currentSet === JSON.stringify(lastCategoriesSet)) {
            // gera novamente
            allCategoryItems.length = 0;
            categories.forEach((cat) => {
                const shuffledItems = [...cat.items];
                shuffle(shuffledItems);
                const fiveItems = shuffledItems.slice(0, 5);
                fiveItems.forEach((item) => {
                    allCategoryItems.push({ emoji: item, category: cat.name });
                });
            });
        }
        lastCategoriesSet = allCategoryItems;

        const contentHTML = [];
        contentHTML.push(
            `<div class="category-game-container" style="flex-direction: row;">`
        );
        categories.forEach((cat) => {
            contentHTML.push(`
        <div class="category-bin"
             data-category="${cat.name}"
             data-filled="0"
             onclick="placeInCategory(this, '${cat.name}')">
          <div class="category-label">${cat.icon} ${cat.name}</div>
          <div class="bin-items-container" id="bin-${cat.name}"></div>
        </div>
      `);
        });
        contentHTML.push(`</div>`);

        contentHTML.push(
            `<div class="category-game-container" style="flex-direction: row;" id="cat-items-container">`
        );
        shuffle(allCategoryItems).forEach((obj) => {
            contentHTML.push(`
        <div class="category-item"
             data-emoji="${obj.emoji}"
             data-cat="${obj.category}"
             onclick="selectCategoryItem(this)">
          ${obj.emoji}
        </div>
      `);
        });
        contentHTML.push(`</div>`);

        content.innerHTML += contentHTML.join("");

        window.categoryGameState = {
            totalItems: allCategoryItems.length,
            correct: 0,
            selectedItem: null,
            selectedElement: null,
        };

        speak("Toque em um item e depois na categoria correta");
    }

    function selectCategoryItem(el) {
        if (window.categoryGameState.selectedElement) {
            window.categoryGameState.selectedElement.style.opacity = "1";
        }
        window.categoryGameState.selectedItem = {
            emoji: el.getAttribute("data-emoji"),
            category: el.getAttribute("data-cat"),
        };
        window.categoryGameState.selectedElement = el;
        el.style.opacity = "0.5";
    }

    function placeInCategory(binEl, targetCategory) {
        const selectedItem = window.categoryGameState.selectedItem;
        const selectedEl = window.categoryGameState.selectedElement;
        if (!selectedItem) return;

        if (selectedItem.category === targetCategory) {
            binEl.classList.add("category-matched");
            const filledCount = parseInt(binEl.getAttribute("data-filled")) + 1;
            binEl.setAttribute("data-filled", filledCount);
            const binContainer = binEl.querySelector(".bin-items-container");
            const newEmojiDiv = document.createElement("div");
            newEmojiDiv.style.fontSize = "2rem";
            newEmojiDiv.textContent = selectedItem.emoji;
            binContainer.appendChild(newEmojiDiv);
            selectedEl.classList.add("hidden-item");
            window.categoryGameState.correct++;
            showFeedback("‚úîÔ∏è Correto!", true);
            speak(`Muito bem! ${selectedItem.emoji} pertence √† categoria ${targetCategory}`);
            if (window.categoryGameState.correct === window.categoryGameState.totalItems) {
                updateStars(1);
                showFeedback("üéâ Parab√©ns! Categorias completadas!", true);
                scheduleNewGame("categories", 2000);
            }
        } else {
            binEl.classList.add("category-wrong");
            setTimeout(() => {
                binEl.classList.remove("category-wrong");
            }, 800);
            showFeedback("‚ùå Categoria incorreta!", false);
            updateStars(-1);
            speak("Essa n√£o √© a categoria certa");
        }

        if (selectedEl) {
            selectedEl.style.opacity = "1";
        }
        window.categoryGameState.selectedItem = null;
        window.categoryGameState.selectedElement = null;
    }

    /*********** LEITURA ************/
    function initReadingGame() {
        const content = document.getElementById("content");
        content.innerHTML = `
      <h2 class="reading-title">Toque para formar a palavra!</h2>
      <div id="reading-result" class="reading-result"></div>
      <div id="reading-syllables" class="reading-word-box"></div>
    `;

        let randomWord = shuffle(readingWords)[0];
        while (randomWord.word === lastReadingWord?.word) {
            randomWord = shuffle(readingWords)[0];
        }
        lastReadingWord = randomWord;

        const originalSyllables = [...randomWord.syllables];
        const scrambled = shuffle([...randomWord.syllables]);
        window.readingGameState = {
            originalWord: randomWord.word,
            syllables: originalSyllables,
            userIndex: 0,
        };

        const resultContainer = document.getElementById("reading-result");
        originalSyllables.forEach((_, idx) => {
            const span = document.createElement("div");
            span.className = "reading-result-syllable";
            span.id = "result-syllable-" + idx;
            resultContainer.appendChild(span);
        });

        const syllablesContainer = document.getElementById("reading-syllables");
        scrambled.forEach((syllable) => {
            const div = document.createElement("div");
            div.className = "reading-syllable";
            div.textContent = syllable;
            div.onclick = function () {
                handleReadingTap(this);
            };
            syllablesContainer.appendChild(div);
        });

        speak(
            `Forme a palavra ${randomWord.word.toUpperCase()}! Toque nas s√≠labas na ordem correta: ${originalSyllables.join(
                "-"
            )}.`
        );
    }

    function handleReadingTap(element) {
        const state = window.readingGameState;
        const nextNeeded = state.syllables[state.userIndex];
        const tapped = element.textContent;

        if (tapped === nextNeeded) {
            const targetSlot = document.getElementById(
                `result-syllable-${state.userIndex}`
            );
            targetSlot.textContent = tapped;
            targetSlot.classList.add("correct");

            element.style.visibility = "hidden";
            speak(tapped);

            state.userIndex++;
            if (state.userIndex === state.syllables.length) {
                showFeedback(
                    `üéâ Parab√©ns! Voc√™ formou a palavra "${state.originalWord.toUpperCase()}"!`,
                    true
                );
                updateStars(1);
                scheduleNewGame("reading", 3000);
            }
        } else {
            showFeedback("Ops! S√≠laba errada, tente novamente!", false);
            speak("Essa n√£o √© a s√≠laba correta");
            updateStars(-1);
        }
    }

    /*********** SISTEMA GERAL ************/
    function speak(text) {
        if (speechSynth.speaking) speechSynth.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = "pt-BR";
        utterance.rate = 0.9;
        speechSynth.speak(utterance);
    }

    function shuffle(array) {
        return array.sort(() => Math.random() - 0.5);
    }

    function updateStars(change) {
        const newStars = Math.max(0, stars + change);
        if (newStars !== stars) {
            stars = newStars;
            localStorage.setItem("stars", stars.toString());
            starsCountEl.textContent = stars;

            // Registra as estrelas tamb√©m para o jogo atual
            if (!gameStars[currentGame]) gameStars[currentGame] = 0;
            gameStars[currentGame] = Math.max(0, gameStars[currentGame] + change);
            localStorage.setItem("gameStars", JSON.stringify(gameStars));

            if (change > 0) {
                speak(`Muito bem!`);
                // Chance de figurinha (1 em 5)
                if (Math.floor(Math.random() * 5) === 0) {
                    giveSticker();
                }
            } else if (change < 0 && stars > 0) {
                speak("N√£o desista! Continue tentando!");
            }

            // Atualizar as estrelas no menu
            buildMainMenu();
        }
    }

    function showFeedback(message, isCorrect) {
        const feedback = document.getElementById("feedback");
        feedback.textContent = message;
        feedback.style.color = isCorrect ? "#2E7D32" : "#C62828";
    }

    /* Figurinhas */
    function giveSticker() {
        const randomSticker =
            possibleStickers[Math.floor(Math.random() * possibleStickers.length)];
        stickerList.push(randomSticker);
        localStorage.setItem("myStickers", JSON.stringify(stickerList));
        alert(`Voc√™ ganhou uma figurinha: ${randomSticker}!`);
    }

    function openStickersModal() {
        const modal = document.getElementById("stickers-modal");
        const backdrop = document.getElementById("modal-backdrop");
        const container = document.getElementById("stickers-container");
        container.innerHTML = "";

        stickerList.forEach((st) => {
            const div = document.createElement("div");
            div.className = "sticker-item";
            div.innerText = st;
            container.appendChild(div);
        });

        backdrop.style.display = "block";
        modal.style.display = "block";
    }

    function closeStickersModal() {
        const modal = document.getElementById("stickers-modal");
        const backdrop = document.getElementById("modal-backdrop");
        modal.style.display = "none";
        backdrop.style.display = "none";
    }
</script>
</body>
</html>
